
# Monthly news - Czerwiec

## Najwa≈ºniejsze
- Zaakceptowane: [Named Arguments](#-%EF%B8%8F-named-arguments-rfc)
- Zaakceptowane: [Nullsafe operator](#-%EF%B8%8F-nullsafe-operator-rfc)
- Odrzucone: [Strict operators directive](#---strict-operators-directive-rfc)

## RFC - Zaakceptowane

### üî• ‚úÖ Named Arguments [[RFC](https://wiki.php.net/rfc/named_params)]
Dnia 24 lipca zdecydowanƒÖ wiƒôkszo≈õciƒÖ (57 g≈Ços√≥w "za", 18 "przeciw") zosta≈Ço przeg≈Çosowane wprowadzenie nazwanych argument√≥w do PHP. Jest to kolejna do≈õƒá spora funkcjonalno≈õƒá, kt√≥rej w tym jƒôzyku nie by≈Ço. Osobi≈õcie cieszƒô siƒô z nowej opcji, ale wielu boi siƒô, ≈ºe bƒôdzie ona wykorzystywana w niepoprawny spos√≥b. Czas poka≈ºe :).

```php
// W chwili obecnej:
array_fill(0, 100, 50);
 
// Mo≈ºliwe od PHP 8:
array_fill(start_index: 0, num: 100, value: 50);
```

### üî• ‚úÖ Nullsafe operator [[RFC](https://wiki.php.net/rfc/nullsafe_operator)]
Wszyscy dobrze wiemy jak czasami irytujƒÖce jest upewnianie siƒô, czy zmienna jest lub nie jest `null`.
```php
$country =  null;
 
if ($session !== null) {
    $user = $session->user;
 
    if ($user !== null) {
        $country = $user->getAddress()->country;
    }
}
```

Na tego typu problemy w Javascript ES2020 wprowadzono operator `?.`. Kto≈õ chyba uzna≈Ç, ≈ºe co≈õ takiego przyda≈Çoby siƒô to w PHP üôÇ.

```php
$country = $session?->user?->getAddress()->country;
```

### ‚úÖ Saner numeric strings [[RFC](https://wiki.php.net/rfc/saner-numeric-strings)]
Zasugerowano modyfikacjƒô logiki interpretowania ≈Ça≈Ñcuch√≥w znak√≥w zawierajƒÖcych liczby. W chwili obecnej taki ≈Ça≈Ñcuch, kt√≥ry zawiera liczby, mo≈ºe byƒá interpretowany na wiele sposob√≥w, i posiada wiele nieprzewidywalnych zachowa≈Ñ:
```php
var_dump("123" == "123.0");  // bool(true)
var_dump("123" == "   123"); // bool(true)
var_dump("123" == "123   "); // bool(false)
var_dump("123" == "123abc"); // bool(false)

var_dump(123 + "123");    // int(246)
var_dump(123 + "   123"); // int(246)

function foo(int $i) { var_dump($i); }
foo("123");    // int(123)
foo("   123"); // int(123)
foo("123   "); // int(123) with E_NOTICE "A non well formed numeric value encountered"
foo("123abc"); // int(123) with E_NOTICE "A non well formed numeric value encountered"
foo("string"); // TypeError
```

Zadaniem tego RFC jest ograniczenie ilo≈õci sposob√≥w interpretowania "numerycznego ≈Ça≈Ñcucha znak√≥w" do takiego stopnia, aby w jego sk≈Çad wchodzi≈Çy tylko te ≈Ça≈Ñcuchy, kt√≥re majƒÖ bia≈Çe znaki przed lub po oraz tylko liczby. Reszta powinna wyrzucaƒá b≈ÇƒÖd `TypeError`.
### ‚úÖ Saner string to number comparisons [[RFC](https://wiki.php.net/rfc/string_to_number_comparison)]
Nikita Popov przy pomocy tego RFC wprowadzi nieco bardziej oczywiste zachowanie przy por√≥wnywaniu ≈Ça≈Ñcuch√≥w znak√≥w z liczbami.
```
Comparison    | Before | After
------------------------------
 0 == "0"     | true   | true
 0 == "0.0"   | true   | true
 0 == "foo"   | true   | false
 0 == ""      | true   | false
42 == "   42" | true   | true
42 == "42foo" | true   | false
```
Zmiany majƒÖ dotyczyƒá:
- operator√≥w "non-strict": `<=>`, `==`, `!=`, `>`, `>=`, `<`, `<=`;
- funkcji `in_array()`, `array_search()` i `array_keys()` z `$strict` ustawionym na `false` (warto≈õƒá domy≈õlna);
- funkcji sortujƒÖce `sort()`, `rsort()`, `asort()`, `arsort()` oraz `array_multisort()` z `$sort_flags` ustawionƒÖ na `SORT_REGULAR` (warto≈õƒá domy≈õlna).

### ‚úÖ Allow trailing comma in closure use lists [[RFC](https://wiki.php.net/rfc/trailing_comma_in_closure_use_list)]
Zmieniono ju≈º wiele miejsc, gdzie dopuszczane jest dodawanie "trailing commas", lecz wystƒôpujƒÖ jeszcze miejsca, gdzie nie jest to mo≈ºliwe.  Takim miejscem jest chocia≈ºby `use` przy funkcjach. Jednak≈ºe i tutaj zostanie to uzupe≈Çnione, gdy≈º 29 lipca w pe≈Çni pozytywnie przeg≈Çosowano tƒÖ zmianƒô :).

```php
$longArgs_longVars = function (
    $longArgument,
    $longerArgument,
    $muchLongerArgument,  // "trailing commas" bƒôdƒÖ obecnie mo≈ºliwe w PHP 8.0
) use (
    $longVar1,
    $longerVar2,
    $muchLongerVar3 // <-- Tutaj ju≈º to nie dzia≈Ça :)
) {
   // body
};
```

### ‚úÖ Configurable string length in getTraceAsString() [[RFC](https://wiki.php.net/rfc/throwable_string_param_max_len)]
W chwili obecnej poni≈ºsze metody zwracajƒÖ zawarto≈õci o maksymalnej d≈Çugo≈õci do 15 bajt√≥w:
- `Throwable->getTraceAsString()`
- `Throwable->__toString()`
RFC proponuje, aby ta d≈Çugo≈õƒá by≈Ça mo≈ºliwa do skonfigurowania przy pomocy nowej opcji konfiguracyjnej:
```
zend.exception_string_param_max_len=15
```

### ‚úÖ Treat namespaced names as single token [[RFC](https://wiki.php.net/rfc/namespaced_names_as_token)]
Obecnie PHP traktuje przestrzenie nazw jako sekwencjƒô identyfikator√≥w. RFC proponuje zmianƒô tego w taki spos√≥b, aby ca≈Ça przestrze≈Ñ nazw by≈Ça traktowana jako jeden token. G≈Ç√≥wnym celem jest zabezpieczenie przypadk√≥w, w kt√≥rych u≈ºywane sƒÖ w przestrzeniach nazw s≈Çowa zarezerwowane w PHP. Na przyk≈Çad, od PHP 7.4 istnieje zarezerwowane s≈Çowo klucze `fn`. Zewnƒôtrzna biblioteka posiadajƒÖca przestrze≈Ñ nazw zawierajƒÖcƒÖ to s≈Çowo klucze bƒôdzie wyrzucaƒá b≈ÇƒÖd "Fatal".

Przyk≈Çad:
```php
namespace myLib\fn

function someFunction() { ... }
```

W skr√≥cie: RFC zabezpieczy wstecznƒÖ kompatybilno≈õƒá na nowsze wersje PHP z nowymi funkcjonalno≈õciami.

Wiƒôcej szczeg√≥≈Ç√≥w znajdziecie w [zawarto≈õci tego RFC](https://wiki.php.net/rfc/shorter_attribute_syntax) üôÇ.

### ‚úÖ Don't automatically unserialize Phar [[RFC](https://wiki.php.net/rfc/phar_stop_autoloading_metadata)]
Jak siƒô okazuje, przez wykonanie tego kodu:
```php
file_exists("phar://...somepath.extension/file/within/phar.ext")
```
plik `phar.ext` zostanie automatycznie odserializowany, co doprowadzi do pobrania kodu oraz jego wywo≈Çania. Wydaje siƒô to niebezpieczne, wiƒôc zosta≈Ço zaproponowane rozwiƒÖzanie, aby odserializowanie zosta≈Ço dokonane dopiero po wywo≈Çaniu czego≈õ w na wz√≥r `Phar->getMetadata()`. G≈Çosowanie w tej sprawie trwa≈Ço do 4 sierpnia, i 25 os√≥b by≈Ço "za" a 0 "przeciw".


## RFC - W trakcie g≈Çosowania

### üöß PHP Namespace Policy [[RFC](https://wiki.php.net/rfc/php_namespace_policy)]
RFC odnoszƒÖce siƒô do stworzenia pewnych dodatkowych zasad co do przestrzeni nazw `\PHP` przesz≈Ço w tryb "Vote". G≈Çosowanie potrwa do 8 sierpnia, ale ju≈º teraz widaƒá, ≈ºe wiƒôkszo≈õƒá g≈ÇosujƒÖcych nie jest tƒÖ zmianƒÖ pozytywnie zainteresowana. RFC ma na celu:
- Zarezerwowanie przestrzeni nazw `\PHP`.
- Ustalenie zasad, w kt√≥rych powy≈ºsza przestrze≈Ñ bƒôdzie u≈ºywana.
- Okre≈õlenie wytycznych w sprawie migrowania istniejƒÖcych ju≈º klas do przestrzeni w przysz≈Ço≈õci.

## RFC - Nowe

### üÜï Language Constructs Syntax Changes [[RFC](https://wiki.php.net/rfc/language-constructs-syntax-changes)]
RFC proponuje dwie drobne zmiany sk≈Çadni:
1. `declare(strict_types: 1);` na `declare strict_types = 1;`
2. `__halt_compiler();`  na `__halt_compiler`


### üÜï Deprecations for PHP 8.1 [[RFC](https://wiki.php.net/rfc/deprecations_php_8_0)]
W sk≈Çad tego RFC wchodzi parƒô rzeczy, kt√≥re zostanƒÖ oznaczone jako "deprecated" w PHP 8.1, a zostanƒÖ ca≈Çkowicie usuniƒôte w PHP 9:
- Ustawienie jako przestarza≈Çe funkcji `date_sunrise()` i `date_sunset()` na rzecz `date_sun_info()`.
- Ustawienie, aby funkcje `key()`, `current()`, `next()`, `prev()`, `reset()` nie operowa≈Çy na obiektach, co dotychczas jest mo≈ºliwe. RozwiƒÖzaniem jest wprowadzenie rzutowania obiektu na tablicƒô zanim operacja zostanie dokonana przez danƒÖ funkcjƒô.
- Uniemo≈ºliwienie wywo≈Çania funkcji `mb_check_encoding()`,  `get_class()`, `get_parent_class()` i `get_called_class()` bez argument√≥w.
- Ustawienie sta≈Çych `FILE_BINARY`, `FILE_TEXT` jako "deprecated".
- Ustawienie flagi `t` u≈ºywanej przy `fopen()` jako "deprecated".
- Uniemo≈ºliwienie podania warto≈õci typu `boolean` jako argument do `IntlCalendar::roll()`.
- Uniemo≈ºliwienie dostania siƒô do metod lub w≈Çasno≈õci statycznych trait√≥w.
```php
trait T {
    public static $foo;
}
class C {
    use T;
}
var_dump(T::$foo); // Dozwolone
```


### üÜï Shorter Attribute Syntax Change [[RFC](https://wiki.php.net/rfc/shorter_attribute_syntax_change)]
Wiele os√≥b nie mo≈ºe siƒô pogodziƒá z nowƒÖ sk≈ÇadniƒÖ dla atrybut√≥w - rozpoczynanie od prefiksu `@@`. Niniejsze RFC chce tƒÖ sk≈Çadniƒô zamieniƒá na `#[]`. Argumenty:

- MogƒÖ wystƒÖpiƒá problemy z parsowaniem.
- Nowa sk≈Çadnia bƒôdzie mia≈Ça wyra≈∫ne rozpoczƒôcie atrybutu `#[` oraz jego zako≈Ñczenie `]`, co pozwala to ≈Çatwiej parsowaƒá, a i daje wiƒôcej mo≈ºliwo≈õci rozwiniƒôcia funkcjonalno≈õci.
- Ze sk≈Çadni `@@` nie korzysta ≈ºaden inny jƒôzyk. Nie jest wiƒôc w ≈ºaden spos√≥b sprawdzona.
- Operator `@` prawdopodobnie nigdy nie zniknie z PHP, w zwiƒÖzku z czym nie bƒôdzie mo≈ºliwo≈õci przej≈õcia `@@` na pojedynczy znak `@`.

## RFC - Odrzucone

### üî• ‚ùå  Strict operators directive [[RFC](https://wiki.php.net/rfc/strict_operators)]
Celem RFC jest wprowadzenie nowej dyrektywy `strict_operators` przyjmujƒÖcƒÖ warto≈õci `0` lub `1`. Jej zadaniem ma byƒá ograniczenie ≈ºonglowania typami w operatorach powodujƒÖcych czasami nieoczekiwanie wyniki. Przyk≈Çady:

```php
$a = '42';
$b = 10;
$c = '9 eur';
 
if (($a > $b) && ($b > $c) && ($c > $a)) {
   // Unexpected 
}
```
```php
$red = '990000';
$purple = '9900e2';
 
$red == $purple; // true
```
```php
$a = ['x' => 1, 'y' => 22];
$b = ['y' => 10, 'x' => 15];
 
$a > $b; // true
$a < $b; // true
```
Z wa≈ºniejszych zmian wchodzƒÖcych w sk≈Çad RFC, ma byƒá:
- Operatory `==`, `!=`, `<`, `>`, `<=`, `>=`, `<=>` bƒôdƒÖ mog≈Çy byƒá zastosowane tylko dla typ√≥w `int` lub `float` (w innym przypadku zostanie wyrzucony `TypeError`.
- Operator konkatenacji zadzia≈Ça tylko na `null`, `int`, `float`, `string` i `stringable`.
- Brak zmian dla operator√≥w `===`, `!==`, `?:`, `??`, `&&`, `||`, `!`, `and`, `or`, and `xor`.

**Update:** RFC wycofano na rzecz [Saner string to number comparisons](https://wiki.php.net/rfc/string_to_number_comparison).

### ‚ùå Make constructors and destructors return void [[RFC](https://wiki.php.net/rfc/make_ctor_ret_void)]
RFC proponowa≈Ço okre≈õliƒá typ zwracany dla konstruktora i destruktora klas, aby konsekwentne m√≥c okre≈õlaƒá sygnaturu dla tych metod magicznych, jako ≈ºe ich reszta [zosta≈Ça ju≈º okre≈õlona](https://wiki.php.net/rfc/magic-methods-signature). Niestety jednak, propozycja nie zdoby≈Ça w g≈Çosowaniu 2/3 g≈Ços√≥w, w zwiƒÖzku z czym zosta≈Ça odrzucona (34 by≈Ço "za", 22 "przeciw").

### ‚ùå StackFrame class [[RFC](https://wiki.php.net/rfc/stack-frame-class)]
W chwili obecnej funkcja `debug_backtrace()` zwraca tablicƒô tablic z informacjami o linii, pliku, klasie, typach, obiektach, argumentach i nazw funkcji jako klucze. RFC proponujƒô alternatywƒô tej funkcji, kt√≥ra zwraca≈Çaby tablicƒô obiekt√≥w klasy `StackFrame`. Takowa tablica zwracana by≈Çaby poprzez statycznƒÖ metodƒô `getTrace()`. G≈Ç√≥wnym celem tego rozwiƒÖzania jest zmniejszenie zu≈ºycia pamiƒôci, oraz poprawa czytelno≈õci. Tak jak w poprzednim RFC, g≈Çosowanie w tym temacie zako≈Ñczy siƒô 4 sierpnia.

```php
final class StackFrame implements ArrayAccess
{
    public readonly string $file;
 
    public readonly int $line;
 
    public readonly ?string $function;
 
    public readonly ?string $class;
 
    public readonly ?object $object;
 
    public readonly ?string $object_class;
 
    public readonly ?\Closure $closure;
 
    public readonly array $args;
 
    public static function getTrace(
	    int $options = DEBUG_BACKTRACE_PROVIDE_OBJECT,
	    int $limit = 0
    ): array {}
 
    public function getFile(): string {}
 
    public function getLine(): int {}
 
    public function getFunction(): ?string {}
 
    public function getClass(): ?string {}
 
    public function getObject(): ?object {}
 
    public function getObjectClass(): ?string {}
 
    public function getClosure(): ?\Closure {}
 
    public function getType(): ?string {}
 
    public function getArgs(): array {}
}
```
Przyk≈Çad:
```php
function frames() {
    return StackFrame::getTrace();
}
$frame = frames()[0];
 
var_dump([
    'file' => $frame['file'],
    'line' => $frame['line'],
    'function' => $frame['function'],
    'class' => $frame['class'],
    'type' => $frame['type'],
    'object' => $frame['object'],
    'args' => $frame['args'],
]);
```

## Inne
- Microsoft zapowiedzia≈Ç, ≈ºe nie bƒôdzie prowadzi≈Ç wsparcia dla PHP 8. Firma wiƒôc nie bƒôdzie dostarczaƒá oficjalnych build√≥w tego jƒôzyka na platformƒô Windows. Zapewne zajmie siƒô tym kto≈õ inny :).
- Od 4 sierpnia nastƒÖpi etap "feature freeze" dla PHP 8. Pozostaje wiƒôc ju≈º niewiele czasu na wdro≈ºenie nowych funkcjonalno≈õci do PHP8, choƒá ju≈º trochƒô ich siƒô narobi≈Ço :).
- Opublikowano PHP8 w wersji "alpha2". Link do ≈õciƒÖgniƒôcia: [LINK](https://downloads.php.net/~carusogabriel/)
